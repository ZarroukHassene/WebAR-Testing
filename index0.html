<html>
<head>
	<title>AR Demo</title>
	<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
	<script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<style>
		video{
			object-fit: cover;
		}
		.center-v button{
			font-size: 3em;
		}
		.center-v {
			height: 500px;
			display: flex;
			align-items: center;
		}
		.arjs-loader {
			height: 100%;
			width: 100%;
			position: absolute;
			top: 0;
			left: 0;
			background-color: rgba(0, 0, 0, 0.8);
			z-index: 9999;
			display: flex;
			justify-content: center;
			align-items: center;
		}

	</style>
	<script>

		var vid;

		$(function() {

			vid  = $('#waterVideo').get(0);

			$( "#start" ).click(function(){

				$('#pre_start').hide();

				vid.play();
				vid.pause();
				vid.currentTime = 0;

			});

		});

		AFRAME.registerComponent('registerevents', {
			init: function() {

				var marker = this.el;

				marker.addEventListener('markerLost', function() {
					vid.pause();
					vid.currentTime = 0;
				});

				marker.addEventListener('markerFound', function() {
					vid.currentTime = 0;
					vid.play();
				});
			}
		});
    



	</script>
</head>
<body style="margin:0; overflow:hidden;">

<div class="arjs-loader" id="pre_start">
	<div class="center-v">
		<button id="start">Start</button>
	</div>
</div>
<a-scene embedded artoolkit=""  arjs='debugUIEnabled: false;'>
	<a-assets >
		<video id="waterVideo" crossorigin="anonymous" src="./media/1_sekou.mp4"></video>
	</a-assets>
	<a-marker preset="hiro" registerevents>
		<a-video id="water" src="#waterVideo" position="0 0 0" rotation="270 0 0" play="true" ></a-video>
		<a-text id="atext" value="Test" color="White" position="-0.5 0 0.8" rotation="270 0 0"  side="double"></a-text>

	</a-marker>
	<a-entity camera></a-entity>
</a-scene>
<div id="controls">
  <button id="playPauseBtn">
      <img id="playPauseIcon" src="./media/playBtn.png" alt="Pause">
      <h3 id="playPauseText"></h3>
  </button>
</div>

<script>
  //Alter the value of a-text of id=text to display src of the video
  var atext = document.getElementById("atext");
  var vidsrc = document.getElementById("waterVideo").getAttribute("src");
    atext.setAttribute("value", vidsrc);

    const playPauseBtn = document.getElementById("playPauseBtn");
  const playPauseIcon = document.getElementById("playPauseIcon");
  const video = document.querySelector("a-video");
  const marker = document.querySelector("a-marker");
  let isPlaying = false;
  let markerVisible = false;

  //Periodically (every 100ms) checks if the video is playing and modifies the text of id=playPauseText accordingly
  setInterval(() => {
    if (isPlaying) {
      playPauseText.innerText = "Playing";
    } else {
      playPauseText.innerText = "Paused";
    }
  }, 100);

  function toggleVideo() {
    if (isPlaying) {
      video.pause();
      playPauseIcon.src = "./media/playBtn.png";
      isPlaying = false;
    } else {
      video.play();
      playPauseIcon.src = "./media/pauseBtn.png";
      isPlaying = true;
    }
  }
  function handleVideoDisplay() {
    if (markerVisible) {
      video.setAttribute("visible", "true");
    } else {
      video.setAttribute("visible", "false");
    }
  }

  // AR marker visibility event listeners
  
  marker.addEventListener("markerFound", () => {
    markerVisible = true;
    handleVideoDisplay();
  });
  marker.addEventListener("markerLost", () => {
    markerVisible = false;
    handleVideoDisplay();
  });

  playPauseBtn.addEventListener("click", toggleVideo);
</script>
</body>
</html>